using System;
using System.Collections.Generic;
using System.Diagnostics.CodeAnalysis;
using System.Linq;

namespace ReCommendedExtension.Tests.test.data
{
    class Preconditions
    {
        void Method([AllowNull] string one, [AllowNull] in string two, [DisallowNull] string? three, [DisallowNull] in string? four)
        {
            Console.WriteLine(|one|(0).Length);
            Console.WriteLine(|two|(1).Length);
            Console.WriteLine(three.Length);
            Console.WriteLine(four.Length);
        }

        [AllowNull]
        string One
        { 
            set => Console.WriteLine(|value|(2).Length);
        }

        [DisallowNull]
        string? Two
        { 
            set => Console.WriteLine(value.Length);
        }

        [AllowNull]
        string this[int x]
        {
            set => Console.WriteLine(|value|(3).Length);
        }
        
        [DisallowNull]
        string? this[bool x]
        {
            set => Console.WriteLine(value.Length);
        }

        void Test()
        {
            Method(null, null, |null|(4), null);

            One = null;
            Two = |null|(5);

            this[1] = null;
            this[true] = |null|(6);
        }
    }

    class PostConditions
    {
        void Method([MaybeNull] out string one, [|NotNull|(7)] out string? two)
        {
            one = null;
            two = |null|(8);
        }

        [return: MaybeNull]
        string Method2() => null;

        [return: |NotNull|(9)]
        string? Method3() => |null|(10);

        [MaybeNull]
        string One => null;

        [|NotNull|(11)]
        string? Two => |null|(12);

        [MaybeNull]
        string this[int x] => null;

        [|NotNull|(13)]
        string? this[bool x] => |null|(14);

        void Test()
        {
            Method(out var one, out var two);
            Console.WriteLine(|one|(15).Length);
            Console.WriteLine(two.Length);

            Console.WriteLine(|Method2()|(16).Length);
            Console.WriteLine(Method3().Length);

            Console.WriteLine(|One|(17).Length);
            Console.WriteLine(Two.Length);

            Console.WriteLine(|this[1]|(18).Length);
            Console.WriteLine(this[true].Length);
        }

        void Test(IEnumerable<string> sequence)
        {
            var item = sequence.FirstOrDefault();
            Console.WriteLine(|item|(19).Length);
        }
    }
}
---------------------------------------------------------
(0): ReSharper Warning: Possible 'System.NullReferenceException'
(1): ReSharper Warning: Possible 'System.NullReferenceException'
(2): ReSharper Warning: Possible 'System.NullReferenceException'
(3): ReSharper Warning: Possible 'System.NullReferenceException'
(4): ReSharper Warning: Possible 'null' assignment to entity marked with 'NotNull' attribute
(5): ReSharper Warning: Possible 'null' assignment to entity marked with 'NotNull' attribute
(6): ReSharper Warning: Possible 'null' assignment to entity marked with 'NotNull' attribute
(7): ReSharper Suggestion: Annotation is redundant because the nullable annotation context is enabled.
(8): ReSharper Warning: Possible 'null' assignment to entity marked with 'NotNull' attribute
(9): ReSharper Suggestion: Annotation is redundant because the nullable annotation context is enabled.
(10): ReSharper Warning: Possible 'null' assignment to entity marked with 'NotNull' attribute
(11): ReSharper Suggestion: Annotation is redundant because the nullable annotation context is enabled.
(12): ReSharper Warning: Possible 'null' assignment to entity marked with 'NotNull' attribute
(13): ReSharper Suggestion: Annotation is redundant because the nullable annotation context is enabled.
(14): ReSharper Warning: Possible 'null' assignment to entity marked with 'NotNull' attribute
(15): ReSharper Warning: Possible 'System.NullReferenceException'
(16): ReSharper Warning: Possible 'System.NullReferenceException'
(17): ReSharper Warning: Possible 'System.NullReferenceException'
(18): ReSharper Warning: Possible 'System.NullReferenceException'
(19): ReSharper Warning: Possible 'System.NullReferenceException'
